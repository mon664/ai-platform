(()=>{var a={};a.id=435,a.ids=[435],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(1237),e=c(5088),f=c(7679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5017:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>A,patchFetch:()=>z,routeModule:()=>v,serverHooks:()=>y,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>x});var d={};c.r(d),c.d(d,{POST:()=>u});var e=c(5736),f=c(9117),g=c(4044),h=c(9326),i=c(2324),j=c(261),k=c(4290),l=c(5328),m=c(8928),n=c(6595),o=c(3421),p=c(7679),q=c(1681),r=c(3446),s=c(6439),t=c(1356);async function u(a){try{let b=await a.formData(),c=b.get("protagonist"),d=b.get("story"),e=b.get("persona")||"",f=parseInt(b.get("sceneCount")),g=b.get("aspectRatio")||"16:9";if(!c||!d)return new Response(JSON.stringify({error:"Missing data"}),{status:400});let h=await c.arrayBuffer(),i=new Uint8Array(h),j="";for(let a=0;a<i.length;a+=8192){let b=i.slice(a,a+8192);j+=String.fromCharCode.apply(null,Array.from(b))}j=btoa(j);let k=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${process.env.GEMINI_API_KEY}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Analyze this person's face with EXTREME precision for AI character consistency. Provide measurements and specific details:

FACE STRUCTURE:
- Face shape (oval/round/square/heart/diamond)
- Facial proportions (forehead:midface:jaw ratio)
- Jawline definition and angle
- Cheekbone prominence and placement

EYES (CRITICAL):
- Exact eye shape (almond/round/hooded/upturned/downturned)
- Eye color (specific shade, patterns, depth)
- Eye size relative to face
- Distance between eyes (wide-set/close-set/average)
- Eyelid type (monolid/double-lid)
- Eyebrow shape, thickness, arch position

NOSE:
- Nose bridge (high/low/straight/curved)
- Nose width and nostril shape
- Nose tip shape (pointed/rounded/bulbous)
- Nose length relative to face

MOUTH & LIPS:
- Lip fullness (upper and lower separately)
- Lip shape and cupid's bow definition
- Mouth width relative to nose
- Smile characteristics

SKIN & COMPLEXION:
- Exact skin tone (warm/cool/neutral undertones)
- Skin texture and any distinctive marks
- Facial hair details (if present)

HAIR:
- Hair color (exact shade and highlights)
- Hair texture and density
- Hairstyle and length
- Hairline shape

DISTINCTIVE FEATURES:
- Moles, freckles, scars (exact position)
- Any unique characteristics

Output: 250-300 words with numerical precision where possible.`},{inlineData:{mimeType:c.type,data:j}}]}]})});if(!k.ok){let a=await k.text();return new Response(a,{status:k.status})}let l=(await k.json()).candidates[0].content.parts[0].text;console.log("[DEBUG] Face description:",l);let m=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${process.env.GEMINI_API_KEY}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Create ${f} detailed scene descriptions for this story: "${d}"
Persona: ${e}

Return only a JSON array: ["scene 1 description", "scene 2 description", ...]`}]}]})});if(!m.ok){let a=await m.text();return new Response(a,{status:m.status})}let n=(await m.json()).candidates[0].content.parts[0].text,o=JSON.parse(n.replace(/```json\n?|\n?```/g,""));console.log("[DEBUG] Scenes array:",o);let p=[];for(let a of(console.log("[DEBUG] Using Nano Banana (gemini-2.5-flash-image) with reference image"),o)){let b=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=${process.env.GEMINI_API_KEY}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Generate a cinematic scene: ${a}

The main character in this scene should look EXACTLY like the person in the reference image provided. Maintain perfect facial consistency including all features, expressions, skin tone, and distinctive marks.

Style: Photorealistic, cinematic lighting, high detail, film quality.`},{inline_data:{mime_type:c.type,data:j}}]}],generationConfig:{response_modalities:["Image"],image_config:{aspect_ratio:g}}})});if(b.ok){let a=await b.json();if(console.log("[DEBUG] Nano Banana response:",JSON.stringify(a).substring(0,500)),!a.candidates||!a.candidates[0]?.content?.parts)return new Response(JSON.stringify({error:"Invalid Nano Banana response",response:JSON.stringify(a).substring(0,500)}),{status:500});let c=a.candidates[0].content.parts.find(a=>a.inlineData);if(!c?.inlineData?.data)return new Response(JSON.stringify({error:"No image data in response",response:JSON.stringify(a).substring(0,500)}),{status:500});let d=c.inlineData.data;p.push(`data:image/png;base64,${d}`)}else{let a=await b.text();return console.error("[ERROR] Nano Banana failed:",a),new Response(JSON.stringify({error:"Nano Banana API failed",status:b.status,details:a.substring(0,500)}),{status:500})}}if(console.log("[DEBUG] Total images generated:",p.length),0===p.length)return new Response(JSON.stringify({error:"No images generated (loop completed but empty)"}),{status:500});return new Response(JSON.stringify({scenes:p}),{headers:{"Content-Type":"application/json"}})}catch(a){return new Response(JSON.stringify({error:a.message}),{status:500})}}let v=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/generate/route",pathname:"/api/generate",filename:"route",bundlePath:"app/api/generate/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\projects\\ai-platform\\app\\api\\generate\\route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:w,workUnitAsyncStorage:x,serverHooks:y}=v;function z(){return(0,g.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:x})}async function A(a,b,c){var d;let e="/api/generate/route";"/index"===e&&(e="/");let g=await v.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:w,nextConfig:x,isDraftMode:y,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!y){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||v.isDev||y||(G="/index"===(G=D)?"/":G);let H=!0===v.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:w,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!x.experimental.cacheComponents,authInterrupts:!!x.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=x.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>v.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>v.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await v.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await v.handleResponse({req:a,nextConfig:x,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),y&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await v.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},5736:(a,b,c)=>{"use strict";a.exports=c(4870)},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},8335:()=>{},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[873],()=>b(b.s=5017));module.exports=c})();