<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <title>AI ì‡¼ì¸  ìƒì„±ê¸° - AI í†µí•© ê´€ë¦¬ í”Œë«í¼</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .shorts-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .generator-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-btn.active {
            background: white;
            color: #667eea;
        }
        .generate-btn {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .generate-btn:hover {
            background: #45a049;
        }
        .result-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s;
        }
        .script-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .scene-image {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .scene-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        .scene-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .regenerate-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .audio-player {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .improve-btn {
            background: #FF9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ -->
    <div id="navigation-container"></div>

    <!-- ì‚¬ìš©ìë‹˜ì´ ì œê³µí•´ì£¼ì‹  HTML ì½”ë“œ ì‹œì‘ -->
    <div class="container mx-auto px-4">
        <header class="text-center my-8">
            <h1 class="text-4xl font-bold">ğŸ¬ AI ì‡¼ì¸  ìƒì„±ê¸°</h1>
            <p class="text-lg text-gray-600 mt-2">AIê°€ ìë™ìœ¼ë¡œ ì‡¼ì¸  ëŒ€ë³¸, ì´ë¯¸ì§€, ìŒì„±ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
        </header>

        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div id="loginSection" class="bg-gray-100 p-8 rounded-lg shadow-md max-w-md mx-auto my-10">
            <h2 class="text-2xl font-bold mb-4 text-center">ë¡œê·¸ì¸</h2>
            <input type="email" id="email" placeholder="ì´ë©”ì¼" value="admin@example.com" class="w-full p-3 mb-4 border border-gray-300 rounded-md">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" value="admin123" class="w-full p-3 mb-6 border border-gray-300 rounded-md">
            <button onclick="login()" class="w-full bg-blue-500 text-white p-3 rounded-md hover:bg-blue-600">ë¡œê·¸ì¸</button>
        </div>

        <!-- ì‡¼ì¸  ìƒì„± ì„¹ì…˜ -->
        <div id="shortsSection" style="display:none;" class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto my-10">
            <h2 class="text-2xl font-bold mb-6 text-center">ì‡¼ì¸  ìƒì„±</h2>
            
            <div class="mb-4">
                <label for="mode" class="block text-gray-700 text-sm font-bold mb-2">ëª¨ë“œ ì„ íƒ:</label>
                <select id="mode" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="keyword">í‚¤ì›Œë“œ ëª¨ë“œ</option>
                    <option value="prompt">í”„ë¡¬í”„íŠ¸ ëª¨ë“œ</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="input" class="block text-gray-700 text-sm font-bold mb-2">ì…ë ¥ (í‚¤ì›Œë“œ ë˜ëŠ” í”„ë¡¬í”„íŠ¸):</label>
                <input type="text" id="input" placeholder="í‚¤ì›Œë“œ ë˜ëŠ” í”„ë¡¬í”„íŠ¸" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label for="duration" class="block text-gray-700 text-sm font-bold mb-2">ì˜ìƒ ê¸¸ì´ (ì´ˆ):</label>
                    <select id="duration" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="30">30ì´ˆ</option>
                        <option value="45">45ì´ˆ</option>
                        <option value="60">60ì´ˆ</option>
                    </select>
                </div>
                <div>
                    <label for="sceneCount" class="block text-gray-700 text-sm font-bold mb-2">ì¥ë©´ ìˆ˜:</label>
                    <select id="sceneCount" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="3">3ì¥ë©´</option>
                        <option value="5">5ì¥ë©´</option>
                        <option value="8">8ì¥ë©´</option>
                    </select>
                </div>
                <div>
                    <label for="imageStyle" class="block text-gray-700 text-sm font-bold mb-2">ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼:</label>
                    <select id="imageStyle" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="photorealistic">ì‹¤ì‚¬</option>
                        <option value="anime">ì• ë‹ˆë©”ì´ì…˜</option>
                        <option value="3d-render">3D ë Œë”</option>
                        <option value="fantasy-art">íŒíƒ€ì§€ ì•„íŠ¸</option>
                        <option value="cinematic">ì˜í™”ì²˜ëŸ¼</option>
                    </select>
                </div>
            </div>

            <button onclick="generateShorts()" class="w-full bg-green-500 text-white p-3 rounded-md hover:bg-green-600 mb-6">ì‡¼ì¸  ìƒì„±</button>
            
            <div id="result" class="mt-8 p-4 border border-gray-300 rounded-md"></div>
        </div>
    </div>
    <!-- ì‚¬ìš©ìë‹˜ì´ ì œê³µí•´ì£¼ì‹  HTML ì½”ë“œ ë -->

    <script>
    // API_BASE_URL ë³€ìˆ˜ ì¶”ê°€ (ê°œë°œ í™˜ê²½ ë° ë°°í¬ í™˜ê²½ì— ë”°ë¼ ë³€ê²½)
    const API_BASE_URL = window.location.origin; // í˜„ì¬ ë„ë©”ì¸ì„ ì‚¬ìš©

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          localStorage.setItem('authToken', data.token);
          document.getElementById('loginSection').style.display = 'none';
          document.getElementById('shortsSection').style.display = 'block';
          alert('ë¡œê·¸ì¸ ì„±ê³µ!');
        } else {
          alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì˜¤ë¥˜: ' + error.message);
      }
    }
    
    async function generateShorts() {
      const token = localStorage.getItem('authToken');
      if (!token) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
        return;
      }
      
      const formData = new FormData();
      formData.append('mode', document.getElementById('mode').value);
      formData.append('input', document.getElementById('input').value);
      formData.append('duration', document.getElementById('duration').value);
      formData.append('sceneCount', document.getElementById('sceneCount').value);
      formData.append('imageStyle', document.getElementById('imageStyle').value);
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/shorts`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });
        
        if (!response.ok) {
          const error = await response.json();
          alert('ì˜¤ë¥˜: ' + (error.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          return;
        }
        
        const data = await response.json();
        
        // ê²°ê³¼ í‘œì‹œ
        let html = '<h3>ëŒ€ë³¸</h3><pre>' + data.script + '</pre>';
        html += '<h3>ìƒì„±ëœ ì´ë¯¸ì§€ (' + data.images.length + 'ê°œ)</h3>';
        data.images.forEach((img, i) => {
          html += `<img src="${img}" style="max-width:200px; margin:5px;"><br>`;
        });
        
        // ì˜¤ë””ì˜¤ ì¬ìƒ ì¶”ê°€
        if (data.audioUrl) {
            html += `<h3>ìƒì„±ëœ ìŒì„±</h3><audio controls src="${data.audioUrl}"></audio><br>`;
        }

        if (data.imageErrors && data.imageErrors.length > 0) {
          html += '<h3 style="color:red;">ì‹¤íŒ¨í•œ ì´ë¯¸ì§€</h3><ul>';
          data.imageErrors.forEach(err => {
            html += '<li>' + err + '</li>';
          });
          html += '</ul>';
        }
        
        document.getElementById('result').innerHTML = html;
      } catch (error) {
        alert('ì˜¤ë¥˜: ' + error.message);
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
    window.onload = function() {
      const token = localStorage.getItem('authToken');
      if (token) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('shortsSection').style.display = 'block';
      }
    };
  </script>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="script.js"></script>
</body>
</html>
