<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìºë¦­í„° ìƒì„±ê¸° - AI í†µí•© ê´€ë¦¬ í”Œë«í¼</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .character-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .generator-form {
            background: linear-gradient(135deg, #9B59B6 0%, #3498DB 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        .generate-btn {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .generate-btn:hover {
            background: #45a049;
        }
        .result-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9B59B6, #3498DB);
            width: 0%;
            transition: width 0.3s;
        }
        .character-result {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        .character-image {
            flex: 1;
            max-width: 500px;
        }
        .character-image img {
            width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .character-info {
            flex: 1;
        }
        .character-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }
        .character-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .character-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .regenerate-btn {
            background: #FF9800;
            color: white;
        }
        .download-btn {
            background: #2196F3;
            color: white;
        }
        .save-btn {
            background: #4CAF50;
            color: white;
        }
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .hidden {
            display: none;
        }
        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .style-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .style-option {
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            color: white;
            transition: all 0.3s;
        }
        .style-option:hover {
            border-color: white;
            background: rgba(255,255,255,0.2);
        }
        .style-option.selected {
            border-color: white;
            background: rgba(255,255,255,0.3);
        }
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .history-item {
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .history-item:hover {
            transform: translateY(-5px);
        }
        .history-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .history-item-info {
            padding: 15px;
        }
        .history-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .history-item-date {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ -->
    <div id="navigation-container"></div>

    <div class="container">

        <div class="character-container">
            <div class="generator-form">
                <h2 style="color: white; margin-bottom: 20px;">ìºë¦­í„° ìƒì„± ì„¤ì •</h2>

                <div id="error-container" class="hidden"></div>
                <div id="success-container" class="hidden"></div>

                <div class="form-group">
                    <label for="characterPrompt">ìºë¦­í„° ì„¤ëª…</label>
                    <textarea id="characterPrompt" rows="4" placeholder="ìƒì„±í•  ìºë¦­í„°ì˜ ì™¸ëª¨, ì„±ê²©, ë°°ê²½ ë“±ì„ ìƒì„¸í•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”...

ì˜ˆì‹œ: 25ì„¸ ì—¬ì„±, ê¸´ ê°ˆìƒ‰ ë¨¸ë¦¬, ë¶€ë“œëŸ¬ìš´ ë¯¸ì†Œ, íŒŒë€ìƒ‰ ëˆˆ, í°ìƒ‰ ì…”ì¸ ì™€ ì²­ë°”ì§€ë¥¼ ì…ìŒ, ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ì„±ê²©"></textarea>
                </div>

                <div class="form-group">
                    <label for="characterName">ìºë¦­í„° ì´ë¦„ (ì„ íƒ)</label>
                    <input type="text" id="characterName" placeholder="ìºë¦­í„°ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label>ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼</label>
                    <div class="style-preview">
                        <div class="style-option selected" data-style="realistic">ì‹¤ì‚¬</div>
                        <div class="style-option" data-style="anime">ì• ë‹ˆë©”ì´ì…˜</div>
                        <div class="style-option" data-style="cartoon">ë§Œí™”</div>
                        <div class="style-option" data-style="3d">3D</div>
                        <div class="style-option" data-style="fantasy">íŒíƒ€ì§€</div>
                        <div class="style-option" data-style="vintage">ë¹ˆí‹°ì§€</div>
                    </div>
                    <input type="hidden" id="imageStyle" value="realistic">
                </div>

                <div class="form-group">
                    <label for="imageRatio">ì´ë¯¸ì§€ ë¹„ìœ¨</label>
                    <select id="imageRatio">
                        <option value="1:1" selected>1:1 (ì •ì‚¬ê°í˜•)</option>
                        <option value="2:3">2:3 (ì¸ë¬¼ ì‚¬ì§„)</option>
                        <option value="3:4">3:4 (ì„¸ë¡œ)</option>
                        <option value="16:9">16:9 (ê°€ë¡œ)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quality">ì´ë¯¸ì§€ í’ˆì§ˆ</label>
                    <select id="quality">
                        <option value="standard" selected>í‘œì¤€</option>
                        <option value="high">ê³ í’ˆì§ˆ</option>
                        <option value="ultra">ìµœê³ í’ˆì§ˆ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tags">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="tags" placeholder="ì˜ˆ: ì£¼ì¸ê³µ, ì—¬ì„±, ì¹œì ˆ, 25ì„¸">
                </div>

                <button class="generate-btn" onclick="generateCharacter()">
                    ğŸ‘¤ ìºë¦­í„° ìƒì„± ì‹œì‘
                </button>
            </div>

            <div id="loading-container" class="result-container hidden">
                <h3>ìºë¦­í„° ìƒì„± ì¤‘...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="progress-text">ì´ˆê¸°í™” ì¤‘...</p>
            </div>

            <div id="result-container" class="result-container hidden">
                <h3>âœ… ìºë¦­í„° ìƒì„± ì™„ë£Œ!</h3>

                <div class="character-result">
                    <div class="character-image">
                        <img id="character-image" src="" alt="ìƒì„±ëœ ìºë¦­í„°">
                    </div>
                    <div class="character-info">
                        <h3 id="character-title">ìºë¦­í„° ì´ë¦„</h3>
                        <div class="character-description" id="character-description">
                            ìºë¦­í„° ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                        <div class="character-tags" id="character-tags"></div>
                        <div class="action-buttons">
                            <button class="action-btn regenerate-btn" onclick="regenerateCharacter()">
                                ğŸ”„ ì¬ìƒì„±
                            </button>
                            <button class="action-btn download-btn" onclick="downloadCharacter()">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="action-btn save-btn" onclick="saveCharacter()">
                                ğŸ’¾ ì €ì¥
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-container" style="margin-top: 30px;">
                <h3>ğŸ“š ìƒì„± íˆìŠ¤í† ë¦¬</h3>
                <div class="history-grid" id="history-grid">
                    <!-- íˆìŠ¤í† ë¦¬ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="script.js"></script>

    <script>
        let generatingCharacter = false;
        let selectedStyle = 'realistic';
        let currentCharacter = null;
        let characterHistory = [];

        // ìŠ¤íƒ€ì¼ ì„ íƒ
        document.querySelectorAll('.style-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedStyle = this.dataset.style;
                document.getElementById('imageStyle').value = selectedStyle;
            });
        });

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="error-message">${message}</div>`;
            container.classList.remove('hidden');
            setTimeout(() => container.classList.add('hidden'), 5000);
        }

        function showSuccess(message) {
            const container = document.getElementById('success-container');
            container.innerHTML = `<div class="success-message">${message}</div>`;
            container.classList.remove('hidden');
            setTimeout(() => container.classList.add('hidden'), 5000);
        }

        function updateProgress(percentage, text) {
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = text;
        }

        async function generateCharacter() {
            if (generatingCharacter) return;

            const prompt = document.getElementById('characterPrompt').value;
            if (!prompt.trim()) {
                showError('ìºë¦­í„° ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            generatingCharacter = true;
            const formData = {
                prompt: prompt.trim(),
                characterName: document.getElementById('characterName').value.trim(),
                imageStyle: selectedStyle,
                imageRatio: document.getElementById('imageRatio').value,
                quality: document.getElementById('quality').value,
                tags: document.getElementById('tags').value
            };

            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading-container').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            document.querySelector('.generate-btn').disabled = true;
            document.querySelector('.generate-btn').textContent = 'â³ ìƒì„± ì¤‘...';

            try {
                updateProgress(10, 'í”„ë¡¬í”„íŠ¸ ë¶„ì„ ì¤‘...');
                await new Promise(resolve => setTimeout(resolve, 1000));

                updateProgress(30, 'ìºë¦­í„° íŠ¹ì„± ì¶”ì¶œ ì¤‘...');
                await new Promise(resolve => setTimeout(resolve, 1500));

                updateProgress(60, 'ì´ë¯¸ì§€ ìƒì„± ì¤‘...');

                // API í˜¸ì¶œ ë˜ëŠ” ë°ëª¨ ë°ì´í„° ìƒì„±
                const result = await generateCharacterImage(formData);

                updateProgress(90, 'ìµœì¢… ì²˜ë¦¬ ì¤‘...');
                await new Promise(resolve => setTimeout(resolve, 500));

                displayCharacterResult(result);

                updateProgress(100, 'âœ… ìºë¦­í„° ìƒì„± ì™„ë£Œ!');
                showSuccess('ìºë¦­í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');

                // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                addToHistory(result);

            } catch (error) {
                showError('ìºë¦­í„° ìƒì„± ì‹¤íŒ¨: ' + error.message);
            } finally {
                generatingCharacter = false;
                document.querySelector('.generate-btn').disabled = false;
                document.querySelector('.generate-btn').textContent = 'ğŸ‘¤ ìºë¦­í„° ìƒì„± ì‹œì‘';

                setTimeout(() => {
                    document.getElementById('loading-container').classList.add('hidden');
                }, 2000);
            }
        }

        async function generateCharacterImage(formData) {
            // ë°ëª¨ ìºë¦­í„° ìƒì„±
            await new Promise(resolve => setTimeout(resolve, 2000));

            const character = {
                id: uuidv4(),
                name: formData.characterName || 'AI ìƒì„± ìºë¦­í„°',
                description: formData.prompt,
                imageUrl: `https://picsum.photos/seed/character_${Date.now()}/500/500.jpg`,
                style: formData.imageStyle,
                ratio: formData.imageRatio,
                quality: formData.quality,
                tags: formData.tags ? formData.tags.split(',').map(tag => tag.trim()) : [],
                createdAt: new Date().toISOString()
            };

            // ì €ì¥ ìš”ì²­
            try {
                const response = await fetch('/api/character', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    character.id = result.id;
                    character.imageUrl = result.imageUrl;
                }
            } catch (error) {
                console.log('API í˜¸ì¶œ ì‹¤íŒ¨, ë°ëª¨ ë°ì´í„° ì‚¬ìš©:', error);
            }

            currentCharacter = character;
            return character;
        }

        function displayCharacterResult(character) {
            document.getElementById('character-image').src = character.imageUrl;
            document.getElementById('character-title').textContent = character.name;
            document.getElementById('character-description').textContent = character.description;

            // íƒœê·¸ í‘œì‹œ
            const tagsContainer = document.getElementById('character-tags');
            tagsContainer.innerHTML = '';
            character.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagsContainer.appendChild(tagElement);
            });

            document.getElementById('result-container').classList.remove('hidden');
        }

        function regenerateCharacter() {
            if (!currentCharacter) return;

            // ì´ì „ ì…ë ¥ê°’ ë³µì›
            document.getElementById('characterPrompt').value = currentCharacter.description;
            document.getElementById('characterName').value = currentCharacter.name !== 'AI ìƒì„± ìºë¦­í„°' ? currentCharacter.name : '';
            document.getElementById('tags').value = currentCharacter.tags.join(', ');

            // ì¬ìƒì„±
            generateCharacter();
        }

        function downloadCharacter() {
            if (!currentCharacter) return;

            const link = document.createElement('a');
            link.href = currentCharacter.imageUrl;
            link.download = `${currentCharacter.name}_${Date.now()}.jpg`;
            link.click();

            showSuccess('ìºë¦­í„° ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.');
        }

        async function saveCharacter() {
            if (!currentCharacter) return;

            try {
                // ì´ë¯¸ ìƒì„±ëœ ìºë¦­í„°ì´ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë§Œ ì²˜ë¦¬
                showSuccess('ìºë¦­í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                showError('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        }

        function addToHistory(character) {
            characterHistory.unshift(character);
            if (characterHistory.length > 12) {
                characterHistory = characterHistory.slice(0, 12);
            }
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyGrid = document.getElementById('history-grid');
            historyGrid.innerHTML = '';

            characterHistory.forEach(character => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.onclick = () => loadCharacterFromHistory(character);

                historyItem.innerHTML = `
                    <img src="${character.imageUrl}" alt="${character.name}">
                    <div class="history-item-info">
                        <div class="history-item-title">${character.name}</div>
                        <div class="history-item-date">${new Date(character.createdAt).toLocaleDateString()}</div>
                    </div>
                `;

                historyGrid.appendChild(historyItem);
            });
        }

        function loadCharacterFromHistory(character) {
            currentCharacter = character;
            displayCharacterResult(character);

            // í¼ì— ê°’ ì„¤ì •
            document.getElementById('characterPrompt').value = character.description;
            document.getElementById('characterName').value = character.name !== 'AI ìƒì„± ìºë¦­í„°' ? character.name : '';
            document.getElementById('tags').value = character.tags.join(', ');

            // ìŠ¤íƒ€ì¼ ì„ íƒ
            document.querySelectorAll('.style-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.style === character.style) {
                    opt.classList.add('selected');
                }
            });
            selectedStyle = character.style;
            document.getElementById('imageStyle').value = selectedStyle;

            // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        // UUID ìƒì„± í•¨ìˆ˜
        function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ì´ˆê¸° íˆìŠ¤í† ë¦¬ ë¡œë“œ
        async function loadHistory() {
            try {
                const response = await fetch('/api/character/history');
                if (response.ok) {
                    const history = await response.json();
                    characterHistory = history;
                    updateHistoryDisplay();
                }
            } catch (error) {
                console.log('íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ ë¡œë“œ
        window.addEventListener('load', loadHistory);
    </script>
    <script src="script.js"></script>
</body>
</html>