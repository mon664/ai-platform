<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <title>ê³ ê¸‰ AI ì±„íŒ… - AI í†µí•© ê´€ë¦¬ í”Œë«í¼</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .chat-container {
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }

        .message-bubble {
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 18px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background: #1976d2;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .upload-zone {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .upload-zone.dragover {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .voice-button {
            transition: all 0.3s;
        }

        .voice-button.recording {
            background: #ef4444;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .model-selector {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
        }

        .context-panel {
            background: #f8fafc;
            border-left: 3px solid #4299e1;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ -->
    <div id="navigation-container"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸ¤– ê³ ê¸‰ AI ì±—</h1>
                    <p class="text-gray-600">í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, íŒŒì¼, ìŒì„±ì„ ì§€ì›í•˜ëŠ” ë‹¤ì¤‘ ëª¨ë“œ AI ì–´ì‹œìŠ¤í„´íŠ¸</p>
                </div>
                <div class="flex items-center space-x-4">
                    <select id="modelSelector" class="model-selector">
                        <option value="gpt-4">GPT-4 (ê³ ì„±ëŠ¥)</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (ë¹ ë¦„)</option>
                        <option value="claude-3">Claude-3 (ë¶„ì„ì „ë¬¸)</option>
                        <option value="gemini-pro">Gemini Pro (ë©€í‹°ëª¨ë“œ)</option>
                    </select>
                    <button id="clearChat" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                        <i class="fas fa-trash mr-2"></i>ëŒ€í™” ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì±— ì»¨í…Œì´ë„ˆ -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- ì±— ë©”ì‹œì§€ ì˜ì—­ -->
            <div class="chat-container">
                <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-4">
                    <!-- í™˜ì˜ ë©”ì‹œì§€ -->
                    <div class="message-bubble text-center mb-6">
                        <div class="inline-block bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full">
                            <i class="fas fa-robot mr-2"></i>
                            ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ë‹¤ì¤‘ ëª¨ë“œ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, íŒŒì¼, ìŒì„±ìœ¼ë¡œ ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
                <div id="uploadZone" class="upload-zone mx-6 mb-4">
                    <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx,.txt,.csv" class="hidden">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                    <p class="text-gray-600">íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    <p class="text-sm text-gray-500 mt-1">ì§€ì› í˜•ì‹: ì´ë¯¸ì§€, PDF, ë¬¸ì„œ, í…ìŠ¤íŠ¸, CSV</p>
                </div>

                <!-- ì…ë ¥ ì˜ì—­ -->
                <div class="border-t border-gray-200 p-4">
                    <div class="flex items-center space-x-3">
                        <!-- ìŒì„± ë…¹ìŒ ë²„íŠ¼ -->
                        <button id="voiceButton" class="voice-button bg-gray-100 text-gray-600 p-3 rounded-full hover:bg-gray-200 transition">
                            <i class="fas fa-microphone"></i>
                        </button>

                        <!-- í…ìŠ¤íŠ¸ ì…ë ¥ -->
                        <div class="flex-1 relative">
                            <textarea
                                id="messageInput"
                                class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                rows="1"
                                placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift+Enterë¡œ ì¤„ë°”ê¿ˆ)"
                            ></textarea>
                            <button id="attachButton" class="absolute right-2 top-2 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        </div>

                        <!-- ì „ì†¡ ë²„íŠ¼ -->
                        <button id="sendButton" class="bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                    <!-- ë¹ ë¥¸ ëª…ë ¹ì–´ -->
                    <div class="mt-3 flex flex-wrap gap-2">
                        <span class="quick-command bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200" data-command="ìš”ì•½">
                            ğŸ“ ìš”ì•½
                        </span>
                        <span class="quick-command bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200" data-command="ë¶„ì„">
                            ğŸ“Š ë¶„ì„
                        </span>
                        <span class="quick-command bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200" data-command="ë²ˆì—­">
                            ğŸŒ ë²ˆì—­
                        </span>
                        <span class="quick-command bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200" data-command="ì½”ë“œ">
                            ğŸ’» ì½”ë“œ
                        </span>
                        <span class="quick-command bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200" data-command="ì•„ì´ë””ì–´">
                            ğŸ’¡ ì•„ì´ë””ì–´
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì»¨í…ìŠ¤íŠ¸ íŒ¨ë„ -->
        <div id="contextPanel" class="context-panel rounded-xl shadow-lg p-6 mt-6 hidden">
            <h3 class="font-semibold text-lg mb-3">ğŸ“‹ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸</h3>
            <div id="contextContent" class="text-sm text-gray-600"></div>
        </div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="script.js"></script>

    <script>
        // ì±— ìƒíƒœ ê´€ë¦¬
        const chatState = {
            messages: [],
            isTyping: false,
            isRecording: false,
            attachedFiles: [],
            currentModel: 'gpt-4'
        };

        // DOM ìš”ì†Œ
        const elements = {
            chatMessages: document.getElementById('chatMessages'),
            messageInput: document.getElementById('messageInput'),
            sendButton: document.getElementById('sendButton'),
            voiceButton: document.getElementById('voiceButton'),
            fileInput: document.getElementById('fileInput'),
            uploadZone: document.getElementById('uploadZone'),
            modelSelector: document.getElementById('modelSelector'),
            clearChat: document.getElementById('clearChat'),
            contextPanel: document.getElementById('contextPanel'),
            contextContent: document.getElementById('contextContent'),
            attachButton: document.getElementById('attachButton')
        };

        // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
        function addMessage(content, isUser = false, type = 'text') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble flex ${isUser ? 'justify-end' : 'justify-start'} mb-4`;

            const bubbleClass = isUser
                ? 'bg-blue-500 text-white'
                : 'bg-gray-100 text-gray-800';

            const icon = isUser ? 'ğŸ‘¤' : 'ğŸ¤–';
            const time = new Date().toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });

            let messageContent = `
                <div class="max-w-2xl">
                    <div class="flex items-center mb-1 ${isUser ? 'justify-end' : 'justify-start'}">
                        <span class="text-xs text-gray-500 mr-2">${time}</span>
                        <span class="text-lg">${icon}</span>
                    </div>
                    <div class="${bubbleClass} px-4 py-3 rounded-lg ${type === 'image' ? 'p-2' : ''}">
            `;

            if (type === 'image') {
                messageContent += `<img src="${content}" alt="ì—…ë¡œë“œëœ ì´ë¯¸ì§€" class="max-w-full rounded-lg">`;
            } else {
                messageContent += `<div class="whitespace-pre-wrap">${content}</div>`;
            }

            messageContent += `
                    </div>
                </div>
            `;

            messageDiv.innerHTML = messageContent;
            elements.chatMessages.appendChild(messageDiv);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

            // ë©”ì‹œì§€ ì €ì¥
            chatState.messages.push({
                content,
                isUser,
                type,
                timestamp: new Date()
            });

            return messageDiv;
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'typingIndicator';
            indicator.className = 'message-bubble flex justify-start mb-4';
            indicator.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            elements.chatMessages.appendChild(indicator);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            chatState.isTyping = true;
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
            chatState.isTyping = false;
        }

        // AI ì‘ë‹µ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜)
        async function generateAIResponse(userMessage) {
            showTypingIndicator();

            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ AI API í˜¸ì¶œ
            await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1500));

            hideTypingIndicator();

            // ê°„ë‹¨í•œ ì‘ë‹µ ìƒì„± ë¡œì§
            let response = "ğŸ¤– AI ì‘ë‹µ: ";

            if (userMessage.includes('ìš”ì•½')) {
                response += "ìš”ì•½ ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ì–´ë–¤ ë‚´ìš©ì„ ìš”ì•½í•´ë“œë¦´ê¹Œìš”?";
            } else if (userMessage.includes('ë¶„ì„')) {
                response += "ë¶„ì„ ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ë¶„ì„í•  ë°ì´í„°ë‚˜ ë‚´ìš©ì„ ì•Œë ¤ì£¼ì„¸ìš”.";
            } else if (userMessage.includes('ë²ˆì—­')) {
                response += "ë²ˆì—­ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. ì–´ë–¤ ì–¸ì–´ë¡œ ë²ˆì—­í• ê¹Œìš”?";
            } else if (userMessage.includes('ì½”ë“œ')) {
                response += "ì½”ë“œ ìƒì„± ë° ë¶„ì„ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì–´ë–¤ ì½”ë“œê°€ í•„ìš”í•˜ì‹ ê°€ìš”?";
            } else if (userMessage.includes('ì•„ì´ë””ì–´')) {
                response += "ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¥¼ ì œì•ˆí•´ë“œë¦½ë‹ˆë‹¤. ì–´ë–¤ ì£¼ì œì— ëŒ€í•œ ì•„ì´ë””ì–´ê°€ í•„ìš”í•˜ì‹ ê°€ìš”?";
            } else {
                const responses = [
                    "í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì…ë‹ˆë‹¤. ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì‹œê² ì–´ìš”?",
                    "ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ìƒê°í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤...",
                    "ì €ì˜ ë„ì›€ì´ í•„ìš”í•˜ì‹  ë¶€ë¶„ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”.",
                    "ì´í•´í–ˆìŠµë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",
                    "í›Œë¥­í•œ ì§ˆë¬¸ì…ë‹ˆë‹¤. ìµœì„ ì„ ë‹¤í•´ ë‹µë³€í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
                ];
                response += responses[Math.floor(Math.random() * responses.length)];
            }

            addMessage(response, false);
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const message = elements.messageInput.value.trim();
            if (!message && chatState.attachedFiles.length === 0) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            if (message) {
                addMessage(message, true);
            }

            // ì²¨ë¶€ íŒŒì¼ ì²˜ë¦¬
            if (chatState.attachedFiles.length > 0) {
                for (const file of chatState.attachedFiles) {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addMessage(e.target.result, true, 'image');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        addMessage(`ğŸ“ ì²¨ë¶€ íŒŒì¼: ${file.name}`, true);
                    }
                }
            }

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            elements.messageInput.value = '';
            chatState.attachedFiles = [];

            // AI ì‘ë‹µ ìƒì„±
            await generateAIResponse(message);
        }

        // ìŒì„± ë…¹ìŒ
        let mediaRecorder;
        let audioChunks = [];

        async function toggleVoiceRecording() {
            if (!chatState.isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        // ì—¬ê¸°ì„œ ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” API í˜¸ì¶œ
                        addMessage("ğŸ¤ ìŒì„± ë©”ì‹œì§€ê°€ ë…¹ìŒë˜ì—ˆìŠµë‹ˆë‹¤.", true);
                        await generateAIResponse("ìŒì„±ìœ¼ë¡œ ë…¹ìŒëœ ë©”ì‹œì§€ì…ë‹ˆë‹¤.");
                    };

                    mediaRecorder.start();
                    chatState.isRecording = true;
                    elements.voiceButton.classList.add('recording');
                    elements.voiceButton.innerHTML = '<i class="fas fa-stop"></i>';
                } catch (error) {
                    console.error('ìŒì„± ë…¹ìŒ ì˜¤ë¥˜:', error);
                    alert('ìŒì„± ë…¹ìŒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            } else {
                mediaRecorder.stop();
                chatState.isRecording = false;
                elements.voiceButton.classList.remove('recording');
                elements.voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
            }
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(files) {
            for (const file of files) {
                chatState.attachedFiles.push(file);
            }
            updateAttachmentIndicator();
        }

        function updateAttachmentIndicator() {
            if (chatState.attachedFiles.length > 0) {
                elements.attachButton.innerHTML = `
                    <i class="fas fa-paperclip text-blue-500"></i>
                    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">
                        ${chatState.attachedFiles.length}
                    </span>
                `;
            } else {
                elements.attachButton.innerHTML = '<i class="fas fa-paperclip"></i>';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        elements.sendButton.addEventListener('click', sendMessage);

        elements.messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        elements.voiceButton.addEventListener('click', toggleVoiceRecording);

        elements.clearChat.addEventListener('click', () => {
            if (confirm('ëŒ€í™” ë‚´ìš©ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                elements.chatMessages.innerHTML = `
                    <div class="message-bubble text-center mb-6">
                        <div class="inline-block bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full">
                            <i class="fas fa-robot mr-2"></i>
                            ëŒ€í™”ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!
                        </div>
                    </div>
                `;
                chatState.messages = [];
            }
        });

        elements.modelSelector.addEventListener('change', (e) => {
            chatState.currentModel = e.target.value;
            addMessage(`ğŸ”„ AI ëª¨ë¸ì„ ${e.target.options[e.target.selectedIndex].text}(ìœ¼)ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`, false);
        });

        // íŒŒì¼ ì—…ë¡œë“œ
        elements.attachButton.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.fileInput.addEventListener('change', (e) => {
            handleFileUpload(e.target.files);
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        elements.uploadZone.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.add('dragover');
        });

        elements.uploadZone.addEventListener('dragleave', () => {
            elements.uploadZone.classList.remove('dragover');
        });

        elements.uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
            handleFileUpload(e.dataTransfer.files);
        });

        // ë¹ ë¥¸ ëª…ë ¹ì–´
        document.querySelectorAll('.quick-command').forEach(command => {
            command.addEventListener('click', () => {
                const cmd = command.dataset.command;
                elements.messageInput.value = cmd + ' ';
                elements.messageInput.focus();
            });
        });

        // ìë™ ë†’ì´ ì¡°ì ˆ
        elements.messageInput.addEventListener('input', () => {
            elements.messageInput.style.height = 'auto';
            elements.messageInput.style.height = Math.min(elements.messageInput.scrollHeight, 120) + 'px';
        });
    </script>
</body>
</html>